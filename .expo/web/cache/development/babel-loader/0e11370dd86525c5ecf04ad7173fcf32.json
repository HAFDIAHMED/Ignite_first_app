{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Api = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _apisauce = require(\"apisauce\");\n\nvar _apiProblem = require(\"./api-problem\");\n\nvar _apiConfig = require(\"./api-config\");\n\nvar Api = function () {\n  function Api() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _apiConfig.DEFAULT_API_CONFIG;\n    (0, _classCallCheck2.default)(this, Api);\n    this.config = config;\n  }\n\n  (0, _createClass2.default)(Api, [{\n    key: \"setup\",\n    value: function setup() {\n      this.apisauce = (0, _apisauce.create)({\n        baseURL: this.config.url,\n        timeout: this.config.timeout,\n        headers: {\n          Accept: \"application/json\"\n        }\n      });\n    }\n  }, {\n    key: \"getUsers\",\n    value: function getUsers() {\n      var response, problem, convertUser, rawUsers, resultUsers;\n      return _regenerator.default.async(function getUsers$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regenerator.default.awrap(this.apisauce.get(\"/users\"));\n\n            case 2:\n              response = _context.sent;\n\n              if (response.ok) {\n                _context.next = 7;\n                break;\n              }\n\n              problem = (0, _apiProblem.getGeneralApiProblem)(response);\n\n              if (!problem) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt(\"return\", problem);\n\n            case 7:\n              convertUser = function convertUser(raw) {\n                return {\n                  id: raw.id,\n                  name: raw.name\n                };\n              };\n\n              _context.prev = 8;\n              rawUsers = response.data;\n              resultUsers = rawUsers.map(convertUser);\n              return _context.abrupt(\"return\", {\n                kind: \"ok\",\n                users: resultUsers\n              });\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](8);\n              return _context.abrupt(\"return\", {\n                kind: \"bad-data\"\n              });\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this, [[8, 14]], Promise);\n    }\n  }, {\n    key: \"getUser\",\n    value: function getUser(id) {\n      var response, problem, resultUser;\n      return _regenerator.default.async(function getUser$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regenerator.default.awrap(this.apisauce.get(\"/users/\" + id));\n\n            case 2:\n              response = _context2.sent;\n\n              if (response.ok) {\n                _context2.next = 7;\n                break;\n              }\n\n              problem = (0, _apiProblem.getGeneralApiProblem)(response);\n\n              if (!problem) {\n                _context2.next = 7;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", problem);\n\n            case 7:\n              _context2.prev = 7;\n              resultUser = {\n                id: response.data.id,\n                name: response.data.name\n              };\n              return _context2.abrupt(\"return\", {\n                kind: \"ok\",\n                user: resultUser\n              });\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](7);\n              return _context2.abrupt(\"return\", {\n                kind: \"bad-data\"\n              });\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this, [[7, 12]], Promise);\n    }\n  }]);\n  return Api;\n}();\n\nexports.Api = Api;","map":{"version":3,"sources":["C:/Users/ahafdi/Desktop/react native/ignite/PizzaApp/app/services/api/api.ts"],"names":["Api","config","DEFAULT_API_CONFIG","apisauce","baseURL","url","timeout","headers","Accept","get","response","ok","problem","convertUser","raw","id","name","rawUsers","data","resultUsers","map","kind","users","resultUser","user"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;IAMaA,G;AAgBX,iBAAoD;AAAA,QAAxCC,MAAwC,uEAApBC,6BAAoB;AAAA;AAClD,SAAKD,MAAL,GAAcA,MAAd;AACD;;;;WASD,iBAAQ;AAEN,WAAKE,QAAL,GAAgB,sBAAO;AACrBC,QAAAA,OAAO,EAAE,KAAKH,MAAL,CAAYI,GADA;AAErBC,QAAAA,OAAO,EAAE,KAAKL,MAAL,CAAYK,OAFA;AAGrBC,QAAAA,OAAO,EAAE;AACPC,UAAAA,MAAM,EAAE;AADD;AAHY,OAAP,CAAhB;AAOD;;;WAKD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAE2C,KAAKL,QAAL,CAAcM,GAAd,UAF3C;;AAAA;AAEQC,cAAAA,QAFR;;AAAA,kBAKOA,QAAQ,CAACC,EALhB;AAAA;AAAA;AAAA;;AAMUC,cAAAA,OANV,GAMoB,sCAAqBF,QAArB,CANpB;;AAAA,mBAOQE,OAPR;AAAA;AAAA;AAAA;;AAAA,+CAOwBA,OAPxB;;AAAA;AAUQC,cAAAA,WAVR,GAUsB,SAAdA,WAAc,CAAAC,GAAG,EAAI;AACzB,uBAAO;AACLC,kBAAAA,EAAE,EAAED,GAAG,CAACC,EADH;AAELC,kBAAAA,IAAI,EAAEF,GAAG,CAACE;AAFL,iBAAP;AAID,eAfH;;AAAA;AAmBUC,cAAAA,QAnBV,GAmBqBP,QAAQ,CAACQ,IAnB9B;AAoBUC,cAAAA,WApBV,GAoBsCF,QAAQ,CAACG,GAAT,CAAaP,WAAb,CApBtC;AAAA,+CAqBW;AAAEQ,gBAAAA,IAAI,EAAE,IAAR;AAAcC,gBAAAA,KAAK,EAAEH;AAArB,eArBX;;AAAA;AAAA;AAAA;AAAA,+CAuBW;AAAEE,gBAAAA,IAAI,EAAE;AAAR,eAvBX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;WA+BA,iBAAcN,EAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAE2C,KAAKZ,QAAL,CAAcM,GAAd,aAA4BM,EAA5B,CAF3C;;AAAA;AAEQL,cAAAA,QAFR;;AAAA,kBAKOA,QAAQ,CAACC,EALhB;AAAA;AAAA;AAAA;;AAMUC,cAAAA,OANV,GAMoB,sCAAqBF,QAArB,CANpB;;AAAA,mBAOQE,OAPR;AAAA;AAAA;AAAA;;AAAA,gDAOwBA,OAPxB;;AAAA;AAAA;AAYUW,cAAAA,UAZV,GAYmC;AAC7BR,gBAAAA,EAAE,EAAEL,QAAQ,CAACQ,IAAT,CAAcH,EADW;AAE7BC,gBAAAA,IAAI,EAAEN,QAAQ,CAACQ,IAAT,CAAcF;AAFS,eAZnC;AAAA,gDAgBW;AAAEK,gBAAAA,IAAI,EAAE,IAAR;AAAcG,gBAAAA,IAAI,EAAED;AAApB,eAhBX;;AAAA;AAAA;AAAA;AAAA,gDAkBW;AAAEF,gBAAAA,IAAI,EAAE;AAAR,eAlBX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import { ApisauceInstance, create, ApiResponse } from \"apisauce\"\nimport { getGeneralApiProblem } from \"./api-problem\"\nimport { ApiConfig, DEFAULT_API_CONFIG } from \"./api-config\"\nimport * as Types from \"./api.types\"\n\n/**\n * Manages all requests to the API.\n */\nexport class Api {\n  /**\n   * The underlying apisauce instance which performs the requests.\n   */\n  apisauce: ApisauceInstance\n\n  /**\n   * Configurable options.\n   */\n  config: ApiConfig\n\n  /**\n   * Creates the api.\n   *\n   * @param config The configuration to use.\n   */\n  constructor(config: ApiConfig = DEFAULT_API_CONFIG) {\n    this.config = config\n  }\n\n  /**\n   * Sets up the API.  This will be called during the bootup\n   * sequence and will happen before the first React component\n   * is mounted.\n   *\n   * Be as quick as possible in here.\n   */\n  setup() {\n    // construct the apisauce instance\n    this.apisauce = create({\n      baseURL: this.config.url,\n      timeout: this.config.timeout,\n      headers: {\n        Accept: \"application/json\",\n      },\n    })\n  }\n\n  /**\n   * Gets a list of users.\n   */\n  async getUsers(): Promise<Types.GetUsersResult> {\n    // make the api call\n    const response: ApiResponse<any> = await this.apisauce.get(`/users`)\n\n    // the typical ways to die when calling an api\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response)\n      if (problem) return problem\n    }\n\n    const convertUser = raw => {\n      return {\n        id: raw.id,\n        name: raw.name,\n      }\n    }\n\n    // transform the data into the format we are expecting\n    try {\n      const rawUsers = response.data\n      const resultUsers: Types.User[] = rawUsers.map(convertUser)\n      return { kind: \"ok\", users: resultUsers }\n    } catch {\n      return { kind: \"bad-data\" }\n    }\n  }\n\n  /**\n   * Gets a single user by ID\n   */\n\n  async getUser(id: string): Promise<Types.GetUserResult> {\n    // make the api call\n    const response: ApiResponse<any> = await this.apisauce.get(`/users/${id}`)\n\n    // the typical ways to die when calling an api\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response)\n      if (problem) return problem\n    }\n\n    // transform the data into the format we are expecting\n    try {\n      const resultUser: Types.User = {\n        id: response.data.id,\n        name: response.data.name,\n      }\n      return { kind: \"ok\", user: resultUser }\n    } catch {\n      return { kind: \"bad-data\" }\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}